version: '3.8'

# Development environment overrides
# This file is automatically loaded by docker-compose in development
# To use production settings, use: docker-compose --env-file .env.production up

services:
  nginx:
    volumes:
      # Mount source code for live reload in development
      - ./nginx/nginx.conf:/etc/nginx/nginx.conf:ro
      - ./nginx/default.conf:/etc/nginx/conf.d/default.conf:ro
    environment:
      - NGINX_ENTRYPOINT_QUIET_LOGS=1

  wordpress:
    environment:
      # Development debug settings
      WP_DEBUG: 'true'
      WP_DEBUG_LOG: 'true'
      WP_DEBUG_DISPLAY: 'true'
      WP_ENV: 'development'
      # Disable OPcache in development for immediate code changes
      PHP_OPCACHE_ENABLE: '0'
    volumes:
      # Additional development volumes
      - ./wp-content/plugins:/var/www/html/wp-content/plugins
      - ./wp-content/themes:/var/www/html/wp-content/themes
      - ./wp-content/uploads:/var/www/html/wp-content/uploads

  db:
    ports:
      # Expose MySQL port for local development tools
      - "3306:3306"
    environment:
      # Enable MySQL general query log in development
      MYSQL_LOG_CONSOLE: 'true'

  redis:
    ports:
      # Expose Redis port for local development tools
      - "6379:6379"
    command: redis-server /usr/local/etc/redis/redis.conf --loglevel debug

  # Optional: PHPMyAdmin for database management in development
  phpmyadmin:
    image: phpmyadmin:latest
    container_name: wp-phpmyadmin
    restart: unless-stopped
    ports:
      - "8080:80"
    environment:
      PMA_HOST: db
      PMA_PORT: 3306
      PMA_ARBITRARY: 1
      UPLOAD_LIMIT: 64M
    networks:
      - wp-network
    depends_on:
      - db

  # Optional: Redis Commander for Redis management in development
  redis-commander:
    container_name: wp-redis-commander
    image: rediscommander/redis-commander:latest
    restart: unless-stopped
    environment:
      REDIS_HOSTS: local:redis:6379
    ports:
      - "8081:8081"
    networks:
      - wp-network
    depends_on:
      - redis