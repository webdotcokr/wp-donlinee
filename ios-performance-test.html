<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>iOS Performance Test - 돈린이</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            background: #f5f5f5;
        }

        .container {
            max-width: 100%;
            padding: 20px;
        }

        h1 {
            font-size: 24px;
            margin-bottom: 20px;
            color: #333;
        }

        .test-section {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .test-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 10px;
            color: #2c3e50;
        }

        .status {
            padding: 10px;
            border-radius: 5px;
            margin-top: 10px;
            font-size: 14px;
        }

        .status.success {
            background: #d4edda;
            color: #155724;
        }

        .status.warning {
            background: #fff3cd;
            color: #856404;
        }

        .status.error {
            background: #f8d7da;
            color: #721c24;
        }

        .metric {
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
            border-bottom: 1px solid #eee;
        }

        .metric:last-child {
            border-bottom: none;
        }

        .metric-label {
            font-weight: 500;
        }

        .metric-value {
            color: #007AFF;
        }

        button {
            background: #007AFF;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            width: 100%;
            margin-top: 10px;
        }

        button:active {
            opacity: 0.8;
        }

        .performance-chart {
            width: 100%;
            height: 200px;
            border: 1px solid #ddd;
            border-radius: 5px;
            margin-top: 10px;
            position: relative;
            overflow: hidden;
        }

        .fps-counter {
            position: fixed;
            top: 10px;
            right: 10px;
            background: rgba(0, 0, 0, 0.7);
            color: #0f0;
            padding: 5px 10px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
            z-index: 9999;
        }

        .test-animation {
            width: 50px;
            height: 50px;
            background: #007AFF;
            border-radius: 50%;
            margin: 20px auto;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% {
                transform: scale(1);
                opacity: 1;
            }
            50% {
                transform: scale(1.2);
                opacity: 0.7;
            }
            100% {
                transform: scale(1);
                opacity: 1;
            }
        }

        .scroll-test {
            height: 300px;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            border: 1px solid #ddd;
            padding: 10px;
            margin-top: 10px;
        }

        .scroll-content {
            height: 1000px;
            background: linear-gradient(to bottom, #007AFF, #fff);
        }

        /* iOS 최적화 확인 */
        .ios-optimized {
            display: none;
        }

        .ios-device .ios-optimized {
            display: block;
            background: #d4edda;
            color: #155724;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <div class="fps-counter" id="fps">FPS: 0</div>

    <div class="container">
        <h1>iOS 성능 테스트</h1>

        <div class="ios-optimized">
            ✅ iOS 최적화가 적용되었습니다!
        </div>

        <!-- 디바이스 정보 -->
        <div class="test-section">
            <div class="test-title">디바이스 정보</div>
            <div id="device-info"></div>
        </div>

        <!-- 성능 메트릭 -->
        <div class="test-section">
            <div class="test-title">성능 메트릭</div>
            <div id="performance-metrics"></div>
            <button onclick="runPerformanceTest()">성능 테스트 실행</button>
        </div>

        <!-- 애니메이션 테스트 -->
        <div class="test-section">
            <div class="test-title">애니메이션 테스트</div>
            <div class="test-animation" id="animation-test"></div>
            <button onclick="toggleAnimation()">애니메이션 토글</button>
            <div class="status" id="animation-status"></div>
        </div>

        <!-- 스크롤 테스트 -->
        <div class="test-section">
            <div class="test-title">스크롤 성능 테스트</div>
            <div class="scroll-test">
                <div class="scroll-content">
                    <p>스크롤 테스트 영역</p>
                    <p>iOS에서 부드럽게 스크롤되는지 확인하세요.</p>
                </div>
            </div>
            <div class="status" id="scroll-status"></div>
        </div>

        <!-- 메모리 사용량 -->
        <div class="test-section">
            <div class="test-title">메모리 사용량</div>
            <div id="memory-usage"></div>
            <button onclick="checkMemory()">메모리 체크</button>
        </div>

        <!-- 최적화 결과 -->
        <div class="test-section">
            <div class="test-title">최적화 결과</div>
            <div id="optimization-results"></div>
        </div>
    </div>

    <script>
        // iOS 감지
        const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;
        const iOSVersion = isIOS ? parseInt((navigator.userAgent.match(/OS (\d+)_/) || [])[1], 10) : null;

        // iOS 클래스 추가
        if (isIOS) {
            document.documentElement.classList.add('ios-device');
            if (iOSVersion) {
                document.documentElement.classList.add('ios-' + iOSVersion);
            }
        }

        // FPS 카운터
        let fps = 0;
        let lastTime = performance.now();
        let frames = 0;

        function updateFPS() {
            const now = performance.now();
            frames++;

            if (now >= lastTime + 1000) {
                fps = Math.round((frames * 1000) / (now - lastTime));
                document.getElementById('fps').textContent = `FPS: ${fps}`;
                frames = 0;
                lastTime = now;

                // FPS에 따라 색상 변경
                const fpsElement = document.getElementById('fps');
                if (fps >= 55) {
                    fpsElement.style.color = '#0f0';
                } else if (fps >= 30) {
                    fpsElement.style.color = '#ff0';
                } else {
                    fpsElement.style.color = '#f00';
                }
            }

            requestAnimationFrame(updateFPS);
        }

        updateFPS();

        // 디바이스 정보 표시
        function showDeviceInfo() {
            const info = document.getElementById('device-info');
            info.innerHTML = `
                <div class="metric">
                    <span class="metric-label">플랫폼:</span>
                    <span class="metric-value">${navigator.platform}</span>
                </div>
                <div class="metric">
                    <span class="metric-label">User Agent:</span>
                    <span class="metric-value" style="font-size: 12px; word-break: break-all;">${navigator.userAgent}</span>
                </div>
                <div class="metric">
                    <span class="metric-label">iOS 감지:</span>
                    <span class="metric-value">${isIOS ? '예' : '아니오'}</span>
                </div>
                ${isIOS ? `
                <div class="metric">
                    <span class="metric-label">iOS 버전:</span>
                    <span class="metric-value">${iOSVersion || '알 수 없음'}</span>
                </div>
                ` : ''}
                <div class="metric">
                    <span class="metric-label">화면 해상도:</span>
                    <span class="metric-value">${window.screen.width} x ${window.screen.height}</span>
                </div>
                <div class="metric">
                    <span class="metric-label">픽셀 비율:</span>
                    <span class="metric-value">${window.devicePixelRatio}</span>
                </div>
            `;
        }

        // 성능 테스트
        function runPerformanceTest() {
            const metrics = document.getElementById('performance-metrics');
            const startTime = performance.now();

            // DOM 조작 테스트
            const testDiv = document.createElement('div');
            for (let i = 0; i < 1000; i++) {
                testDiv.innerHTML += `<span>${i}</span>`;
            }

            const domTime = performance.now() - startTime;

            // 계산 테스트
            const calcStart = performance.now();
            let sum = 0;
            for (let i = 0; i < 1000000; i++) {
                sum += Math.sqrt(i);
            }
            const calcTime = performance.now() - calcStart;

            // 결과 표시
            metrics.innerHTML = `
                <div class="metric">
                    <span class="metric-label">DOM 조작 시간:</span>
                    <span class="metric-value">${domTime.toFixed(2)}ms</span>
                </div>
                <div class="metric">
                    <span class="metric-label">계산 시간:</span>
                    <span class="metric-value">${calcTime.toFixed(2)}ms</span>
                </div>
                <div class="metric">
                    <span class="metric-label">총 시간:</span>
                    <span class="metric-value">${(domTime + calcTime).toFixed(2)}ms</span>
                </div>
                <div class="status ${(domTime + calcTime) < 100 ? 'success' : 'warning'}">
                    ${(domTime + calcTime) < 100 ? '✅ 성능 양호' : '⚠️ 성능 개선 필요'}
                </div>
            `;
        }

        // 애니메이션 토글
        let animationEnabled = true;
        function toggleAnimation() {
            const element = document.getElementById('animation-test');
            const status = document.getElementById('animation-status');

            if (animationEnabled) {
                element.style.animation = 'none';
                status.innerHTML = '<div class="status warning">애니메이션 중지됨</div>';
            } else {
                element.style.animation = 'pulse 2s infinite';
                status.innerHTML = '<div class="status success">애니메이션 실행 중</div>';
            }
            animationEnabled = !animationEnabled;
        }

        // 메모리 체크
        function checkMemory() {
            const usage = document.getElementById('memory-usage');

            if (performance.memory) {
                const used = (performance.memory.usedJSHeapSize / 1024 / 1024).toFixed(2);
                const total = (performance.memory.totalJSHeapSize / 1024 / 1024).toFixed(2);
                const limit = (performance.memory.jsHeapSizeLimit / 1024 / 1024).toFixed(2);

                usage.innerHTML = `
                    <div class="metric">
                        <span class="metric-label">사용 중:</span>
                        <span class="metric-value">${used} MB</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">할당됨:</span>
                        <span class="metric-value">${total} MB</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">제한:</span>
                        <span class="metric-value">${limit} MB</span>
                    </div>
                `;
            } else {
                usage.innerHTML = '<div class="status warning">메모리 API를 지원하지 않습니다 (Safari)</div>';
            }
        }

        // 스크롤 성능 모니터링
        let scrollEvents = 0;
        let scrollStart = 0;
        document.querySelector('.scroll-test').addEventListener('scroll', function() {
            if (scrollStart === 0) {
                scrollStart = performance.now();
            }
            scrollEvents++;

            setTimeout(() => {
                if (scrollEvents > 0) {
                    const elapsed = performance.now() - scrollStart;
                    const eventsPerSecond = (scrollEvents / elapsed * 1000).toFixed(1);
                    document.getElementById('scroll-status').innerHTML = `
                        <div class="status success">
                            스크롤 이벤트: ${scrollEvents}회 / ${(elapsed/1000).toFixed(1)}초
                            (${eventsPerSecond} 이벤트/초)
                        </div>
                    `;
                    scrollEvents = 0;
                    scrollStart = 0;
                }
            }, 1000);
        }, { passive: true });

        // 최적화 결과 표시
        function showOptimizationResults() {
            const results = document.getElementById('optimization-results');
            const optimizations = [];

            // iOS 최적화 체크
            if (isIOS) {
                optimizations.push('✅ iOS 디바이스 감지됨');
                optimizations.push('✅ iOS 최적화 CSS 적용');
                optimizations.push('✅ 스크롤 이벤트 Passive 리스너 사용');
                optimizations.push('✅ 애니메이션 최적화 적용');

                if (document.documentElement.classList.contains('ios-device')) {
                    optimizations.push('✅ iOS 클래스 추가됨');
                }
            } else {
                optimizations.push('ℹ️ iOS가 아닌 디바이스입니다');
            }

            // FPS 체크
            if (fps >= 55) {
                optimizations.push(`✅ FPS 양호: ${fps}`);
            } else {
                optimizations.push(`⚠️ FPS 개선 필요: ${fps}`);
            }

            results.innerHTML = optimizations.map(item => `<div>${item}</div>`).join('');
        }

        // 초기화
        showDeviceInfo();
        setTimeout(showOptimizationResults, 2000); // FPS 측정 후 표시

        // iOS 최적화 스크립트 로드 확인
        if (window.iOSOptimizations) {
            console.log('iOS Optimizations loaded:', window.iOSOptimizations);
        }
    </script>
</body>
</html>